<!DOCTYPE html>
<html>
<head>
	<title>iTunesify Remote Configuration</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-theme.min.css" rel="stylesheet">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	
</head>
<body>
    <div class="container">
		<div class="configure">
			<h2>Configure</h2>
	    	<form id="configure-form" class="form-configure well" action="#" method="POST">
	    		<h3>Server</h3>
	        	<div class="form-group">
	        		<label for="iTunesServer">iTunes Server</label>
	        		<input type="text" id="server" name="server" class="form-control" placeholder="192.168.1.117">
				</div>	
	        	
	        	<input class="btn btn-lg btn-primary btn-block" id="save" type="submit" value="Save">
	      </form>
	  </div>

    </div>
    <div class="footer container">
    	<p><a href="http://github.com/macecchi/pebble-itunesify-remote">iTunesify Remote</a></p>
    </div>
	<script type="text/javascript">
		// Get query variables
		function getQueryParam(variable, defaultValue) {
		  // Find all URL parameters
		  var query = location.search.substring(1);
		  var vars = query.split('&');
		  for (var i = 0; i < vars.length; i++) {
		    var pair = vars[i].split('=');

		    // If the query variable parameter is found, decode it to use and return it for use
		    if (pair[0] === variable) {
		      return decodeURIComponent(pair[1]);
		    }
		  }
		  return defaultValue || false;
		}
		
		$("#server").val(localStorage.getItem("server"));
		$("#configure-form").submit(function(e) {
			var settings = {
				server: $("#server").val()
			};
    		localStorage.setItem("server", $("#server").val());  

    		console.log('teste');

			// Set the return URL depending on the runtime environment
			var return_to = getQueryParam('return_to', 'pebblejs://close#');
			document.location = return_to + encodeURIComponent(JSON.stringify(settings));

			e.preventDefault();
		});	
</script>
</body>
</html>